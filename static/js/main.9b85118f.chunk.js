(this["webpackJsonpmozio-sdk-partner-generator"]=this["webpackJsonpmozio-sdk-partner-generator"]||[]).push([[0],{35:function(e,t,n){e.exports=n(97)},40:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(31),i=n.n(o),l=(n(40),n(4)),s=n(5),c=n(8),u=n(6),m=n(2),h=n(7),p=n(3),d=n.n(p),g=n(32),b=n(16),f=[{name:"name",type:"text",label:"Partner Name",error:!1,background:null},{name:"code",type:"text",label:"Partner ID (unlock code)",error:!1,background:null},{name:"tint_color",type:"color",label:"Tint Color",error:!1,background:null},{name:"contrast_tint_color",type:"color",label:"Contrast Tint Color",error:!1,background:null},{name:"primary_color",type:"color",label:"Primary Color",error:!1,background:null},{name:"secondary_color",type:"color",label:"Secondary Color",error:!1,background:null},{name:"accept_color",type:"color",label:"Accept (success) Color",error:!1,background:null},{name:"error_color",type:"color",label:"Error Color",error:!1,background:null},{name:"id",type:"text",label:"Internal ID (autogenerated)",error:!1,background:null}],v={LOGO:"logo",SCREEN_IMAGE:"screenImage",SCREEN_WIDE_IMAGE:"screenWideImage",DATA:"data"},E=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={fields:f,step:v.LOGO,data:{},logoDataURL:null,logoFile:null,screenImageDataURL:null,screenImageFile:null,screenWideImageDataURL:null,screenWideImageFile:null},n.handleSubmit=n.handleSubmit.bind(Object(m.a)(n)),n.logoFileDropped=n.logoFileDropped.bind(Object(m.a)(n)),n.screenImageFileDropped=n.screenImageFileDropped.bind(Object(m.a)(n)),n.screenWideImageFileDropped=n.screenWideImageFileDropped.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"hasErrors",value:function(){console.log("Checking for errors... "+JSON.stringify(this.state.fields,null,2));var e=!0,t=!1,n=void 0;try{for(var r,a=this.state.fields[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){if(r.value.error)return!0}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}return!1}},{key:"handleSubmit",value:function(e){if(e.preventDefault(),this.hasErrors())alert("Not so fast! There are some errors, please check the data...");else{var t=new FormData(e.target),n={};t.forEach((function(e,t){null!==e&&""!==e&&(n[t]=e)}));var r={logo:this.state.logoFile,screenImage:this.state.screenImageFile,screenWideImage:this.state.screenWideImageFile};this.props.onSubmit(n,r)}}},{key:"logoFileDropped",value:function(e){var t=this,n=e[0],r=new FileReader;r.onload=function(e){var r=t.state.step;t.setState({logoDataURL:e.target.result,logoFile:n,step:r===v.LOGO?v.SCREEN_IMAGE:r})},r.readAsDataURL(n)}},{key:"screenImageFileDropped",value:function(e){var t=this,n=e[0],r=new FileReader;r.onload=function(e){var r=t.state.step;t.setState({screenImageDataURL:e.target.result,screenImageFile:n,step:r===v.SCREEN_IMAGE?v.SCREEN_WIDE_IMAGE:r})},r.readAsDataURL(n)}},{key:"screenWideImageFileDropped",value:function(e){var t=this,n=e[0],r=new FileReader;r.onload=function(e){var r=t.state.step;t.setState({screenWideImageDataURL:e.target.result,screenWideImageFile:n,step:r===v.SCREEN_WIDE_IMAGE?v.DATA:r})},r.readAsDataURL(n)}},{key:"onDropInvalidFile",value:function(){alert("Now slow down! This doesn't seem to be a valid image. We only accept PNGs...")}},{key:"fieldChangeCallback",value:function(e){var t=this;return"color"===e.type?function(n){var r,a=(r=n.target.value).startsWith("#")&&7===r.length?r:r.startsWith("#")||6!==r.length?r:"#"+r,o=function(e){return/^#[0-9A-F]{6}$/i.test(e)}(a);t.setFieldBackgroundColor(e,o?a:null,(function(){t.setFieldErrorState(e,!o&&""!==a,(function(){t.setState({data:Object.assign({},t.state.data,Object(g.a)({},e.name,a))})}))}))}:"name"===e.name?function(e){var n=e.target.value;if(""!==n){var r=n.replace(/\s+/g,"").toLowerCase();t.setState({data:Object.assign({},t.state.data,{id:r,code:r+Math.floor(8999*Math.random()+1e3)})})}}:function(e){}}},{key:"setFieldBackgroundColor",value:function(e,t,n){console.log("Setting "+e.name+" background color to "+t),this.setState({fields:this.state.fields.map((function(n){return n.name===e.name?Object.assign({},n,{background:t}):n}))},n)}},{key:"setFieldErrorState",value:function(e,t,n){this.setState({fields:this.state.fields.map((function(n){return n.name===e.name?Object.assign({},n,{error:t}):n}))},n)}},{key:"render",value:function(){var e=this,t=[a.a.createElement(b.a,{key:"logoPicker",accept:["image/png"],multiple:!1,onDropAccepted:this.logoFileDropped,onDropRejected:this.onDropInvalidFile},(function(t){var n=t.getRootProps,r=t.getInputProps;return a.a.createElement("section",null,a.a.createElement("div",n(),a.a.createElement("input",r()),a.a.createElement("p",null,"Drop the partner LOGO here (or click to select file)",e.state.logoDataURL&&a.a.createElement("img",{className:"logo",alt:"Logo",src:e.state.logoDataURL}))))})),a.a.createElement(b.a,{key:"screenImagePicker",accept:["image/png"],multiple:!1,onDropAccepted:this.screenImageFileDropped,onDropRejected:this.onDropInvalidFile},(function(t){var n=t.getRootProps,r=t.getInputProps;return a.a.createElement("section",null,a.a.createElement("div",n(),a.a.createElement("input",r()),a.a.createElement("p",null,"Drop the NARROW SCREEN IMAGE here (or click to select file)",e.state.screenImageDataURL&&a.a.createElement("img",{className:"screen-image",alt:"Screen",src:e.state.screenImageDataURL}))))})),a.a.createElement(b.a,{key:"screenWideImagePicker",accept:["image/png","image/jpeg"],multiple:!1,onDropAccepted:this.screenWideImageFileDropped,onDropRejected:this.onDropInvalidFile},(function(t){var n=t.getRootProps,r=t.getInputProps;return a.a.createElement("section",null,a.a.createElement("div",n(),a.a.createElement("input",r()),a.a.createElement("p",null,"Drop the WIDE SCREEN IMAGE here (or click to select file)",e.state.screenWideImageDataURL&&a.a.createElement("img",{className:"screen-image",alt:"Screen wide",src:e.state.screenWideImageDataURL}))))})),this.state.fields.map((function(t,n){console.log("Background: "+t.background);var r={backgroundColor:t.background};return t.error&&(r.borderBottom="thick solid #FF0000"),a.a.createElement(a.a.Fragment,{key:t.name},a.a.createElement("label",null,t.label,a.a.createElement("input",{name:t.name,type:"text",value:e.state.data[t.name],onChange:e.fieldChangeCallback(t),style:r})))})),a.a.createElement("button",{type:"submit"},"Submit demo!")];return a.a.createElement("form",{onSubmit:this.handleSubmit},function(){switch(e.state.step){case v.LOGO:return t.slice(0,1);case v.SCREEN_IMAGE:return t.slice(0,2);case v.SCREEN_WIDE_IMAGE:return t.slice(0,3);default:return t}}())}}]),t}(r.Component),k=function(){function e(){Object(l.a)(this,e)}return Object(s.a)(e,[{key:"readFileAsBas64String",value:function(e){return new Promise((function(t,n){var r=new FileReader;r.readAsDataURL(e),r.onload=function(){var e=r.result.toString().replace(/^data:(.*,)?/,"");e.length%4>0&&(e+="=".repeat(4-e.length%4)),t(e)},r.onerror=function(e){return n(e)}}))}}]),e}(),y=function(){function e(t,n,r){Object(l.a)(this,e),this.owner=t,this.repo=n,this.github=r}return Object(s.a)(e,[{key:"createImageFileTrees",value:function(e,t){var n=this;return d.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.github.git.getRef({owner:this.owner,repo:this.repo,ref:"heads/"+t}).then((function(t){var r,a,o,i,l,s,c,u,m;return d.a.async((function(h){for(;;)switch(h.prev=h.next){case 0:r=t.data.object.sha,a=[],o=!0,i=!1,l=void 0,h.prev=5,s=e[Symbol.iterator]();case 7:if(o=(c=s.next()).done){h.next=16;break}return u=c.value,h.next=11,d.a.awrap(n.github.git.createBlob({owner:n.owner,repo:n.repo,content:u.content,encoding:"base64"}));case 11:m=h.sent,a.push({path:u.path,sha:m.data.sha,mode:"100644",type:"blob"});case 13:o=!0,h.next=7;break;case 16:h.next=22;break;case 18:h.prev=18,h.t0=h.catch(5),i=!0,l=h.t0;case 22:h.prev=22,h.prev=23,o||null==s.return||s.return();case 25:if(h.prev=25,!i){h.next=28;break}throw l;case 28:return h.finish(25);case 29:return h.finish(22);case 30:return h.abrupt("return",n.github.git.createTree({owner:n.owner,repo:n.repo,base_tree:r,tree:a}).then((function(e){return{parentSha:r,treeSha:e.data.sha}})));case 32:case"end":return h.stop()}}),null,null,[[5,18,22,30],[23,,25,29]])})));case 1:case"end":return r.stop()}}),null,this)}},{key:"createJsonFileTree",value:function(e,t){return this.github.git.createTree({owner:this.owner,repo:this.repo,base_tree:t.sha,tree:[{path:e.path,content:e.content,mode:"100644",type:"blob"}]}).then((function(e){return{parentSha:t.sha,treeSha:e.data.sha}}))}},{key:"commitFromTree",value:function(e,t){return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("commitBranchFromTree: "+JSON.stringify(e,null,2)),n.abrupt("return",this.github.git.createCommit({owner:this.owner,repo:this.repo,message:t,tree:e.treeSha,parents:[e.parentSha]}).then((function(e){return{sha:e.data.sha}})));case 2:case"end":return n.stop()}}),null,this)}},{key:"branchFromCommit",value:function(e,t){return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.github.git.createRef({owner:this.owner,repo:this.repo,ref:"refs/heads/"+t,sha:e.sha}));case 1:case"end":return n.stop()}}),null,this)}},{key:"pullRequestFromBranch",value:function(e,t,n){return d.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.github.pulls.create({owner:this.owner,repo:this.repo,title:t,body:n,head:e,base:"master"}));case 1:case"end":return r.stop()}}),null,this)}}]),e}(),w=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).gitHubController=new y("mozioinc","sdk_demos",n.props.github),n.utils=new k,n.state={partners:[],loading:!1},n.onSubmit=n.onSubmit.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"getJsonPartners",value:function(){var e,t;return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.a.awrap(fetch("https://raw.githubusercontent.com/mozioinc/sdk_demos/master/demos.json"));case 2:return e=n.sent,n.next=5,d.a.awrap(e.text());case 5:return t=n.sent,console.log(e),n.abrupt("return",JSON.parse(atob(t)));case 8:case"end":return n.stop()}}))}},{key:"componentDidMount",value:function(){var e=this;this.getJsonPartners().then((function(t){console.log(t),e.setState({partners:t})}))}},{key:"onSubmit",value:function(e,t){var n=this;if(this.validateOrAbort(e)){window.scrollTo(0,0),this.setState({loading:!0});var r="demo-"+e.id,a="logo_"+e.id+".png",o=e.id+"_narrow.png",i=e.id+"_wide.png";new Promise((function(e,r){return d.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=e,r.t1="images/"+a,r.next=4,d.a.awrap(n.utils.readFileAsBas64String(t.logo));case 4:return r.t2=r.sent,r.t3={path:r.t1,content:r.t2},r.t4="images/"+o,r.next=9,d.a.awrap(n.utils.readFileAsBas64String(t.screenImage));case 9:return r.t5=r.sent,r.t6={path:r.t4,content:r.t5},r.t7="images/"+i,r.next=14,d.a.awrap(n.utils.readFileAsBas64String(t.screenWideImage));case 14:r.t8=r.sent,r.t9={path:r.t7,content:r.t8},r.t10=[r.t3,r.t6,r.t9],(0,r.t0)(r.t10);case 18:case"end":return r.stop()}}))})).then((function(e){return n.gitHubController.createImageFileTrees(e,"master")})).then((function(e){return n.gitHubController.commitFromTree(e,"Add image files")})).then((function(t){e.logo_url="https://raw.githubusercontent.com/mozioinc/sdk_demos/{branch_name}/images/"+a,e.screen_image_url="https://raw.githubusercontent.com/mozioinc/sdk_demos/{branch_name}/images/"+o,e.screen_wide_image_url="https://raw.githubusercontent.com/mozioinc/sdk_demos/{branch_name}/images/"+i;var r=!1,l=n.state.partners.map((function(t){return t.id===e.id?(r=!0,e):t}));r||l.push(e);var s={content:btoa(JSON.stringify(l)),path:"demos.json"};return n.gitHubController.createJsonFileTree(s,t)})).then((function(e){return n.gitHubController.commitFromTree(e,"Add JSON file")})).then((function(e){return n.gitHubController.branchFromCommit(e,r)})).then((function(){var t=e.name,a="Adds all necessary files for the `"+e.name+"` demo: \n```\n"+JSON.stringify(e,null,2)+"\n```";return n.gitHubController.pullRequestFromBranch(r,t,a)})).then((function(e){alert("Success!"),window.open(e.data.html_url)}),(function(e){alert("Error... "+e)})).finally((function(){n.setState({loading:!1})}))}}},{key:"validateOrAbort",value:function(e){return e.id&&""!==e.id?e.tint_color&&""!==e.tint_color?e.contrast_tint_color&&""!==e.contrast_tint_color?!(!e.primary_color||""===e.primary_color)||(alert("Please fill in the primary color!"),!1):(alert("Please fill in the contrast tint color!"),!1):(alert("Please fill in the tint color!"),!1):(alert("Please fill in the ID!"),!1)}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("ul",{className:"column"},this.state.partners.map((function(e){return a.a.createElement("li",{key:e.id},a.a.createElement("p",null,e.name),a.a.createElement("img",{className:"partner-logo",src:e.logo_url,alt:e.name}))}))),this.state.loading||a.a.createElement("div",{className:"column form"},a.a.createElement(E,{onSubmit:this.onSubmit})),this.state.loading&&a.a.createElement("p",null,"Saving..."))}}]),t}(r.Component),S=n(34),I=n.n(S),D=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={},n.handleSubmit=n.handleSubmit.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"handleSubmit",value:function(e){e.preventDefault();var t=new FormData(e.target),n={};t.forEach((function(e,t){n[t]=e}));var r=new I.a({auth:n.access_token,userAgent:"SDK Partnerator"});this.props.onLogin(r)}},{key:"render",value:function(){return a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("label",null,"Github access token",a.a.createElement("input",{name:"access_token",type:"password"})),a.a.createElement("p",null,"Create one here: ",a.a.createElement("a",{href:"https://github.com/settings/tokens",target:"_blank",rel:"noopener noreferrer"}," https://github.com/settings/tokens ")),a.a.createElement("p",null,"ONLY give access to ",a.a.createElement("b",null,"public_repo")),a.a.createElement("button",{type:"submit"},"Proceed"))}}]),t}(r.Component),F=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={github:null},n.handleLogin=n.handleLogin.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"handleLogin",value:function(e){this.setState({github:e})}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,null!=this.state.github||a.a.createElement(D,{onLogin:this.handleLogin}),this.state.github&&a.a.createElement(w,{github:this.state.github}))}}]),t}(r.Component);var O=function(){return a.a.createElement("div",null,a.a.createElement("h1",null,"SDK Partnerator 3000"),a.a.createElement(F,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[35,1,2]]]);
//# sourceMappingURL=main.9b85118f.chunk.js.map